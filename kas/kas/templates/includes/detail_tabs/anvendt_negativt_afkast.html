{% load i18n %}
{% with marked_year=policy.year used_negativ_table=policy.previous_year_deduction_table_data %}
<table class="table table-bordered table-hover table-sm" style="width: auto;">
    <thead>
    <tr class="table-info">
        <th colspan="2"></th>
        <th colspan="{{ used_negativ_table|length|add:-1 }}" class="text-center">{% translate 'Anvendt i år' %}</th>
        <th></th>
    </tr>
    <tr>
        <th class="table-info">{% translate 'År' %}</th>
        <th class="table-info">{% translate 'Negativt afkast' %}</th>
        {% for year in used_negativ_table.keys %}
            {% if not forloop.first %}
                <th class="table-{% if marked_year == year %}primary{% else %}info{% endif %}">{{ year }}</th>
            {% endif %}
        {% endfor %}
        <th class="table-info">{% translate 'Resterende' %}</th>
    </tr>
    </thead>
    <tbody>
    {% for year, data in used_negativ_table.items %}
        {% if not forloop.last %}
            <tr>
                <th>{{ year }}</th>
                <td class="text-right">{{ data.available }}</td>
                {% for year2, value in data.used_by_year.items %}
                    {% if not forloop.first %}
                        {% if value == "-" %}
                            <td class="table-secondary"></td>
                        {% else %}
                            <td class="text-right{% if marked_year == year2 %} table-success{% endif %}">{{ value }}</td>
                        {% endif %}
                    {% endif %}
                {% endfor%}
                <td class="text-right">{{ data.remaining }}</td>
            </tr>
        {% endif %}
    {% endfor %}
    <tr>
        <th colspan="2">{% translate 'Totalt anvendt' %}</th>
        {% for year, data in used_negativ_table.items %}
            {% if not forloop.first %}
                <td class="text-right{% if marked_year == year %} table-success{% endif %}">{{ data.used_total }}</td>
            {% endif %}
        {% endfor %}
        <td></td>
    </tr>
    </tbody>
</table>
{% endwith %}
